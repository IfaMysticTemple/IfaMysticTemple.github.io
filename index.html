<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Image Vote — Odu Preview</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0b0b0f; --ink:#eaeaf2; --muted:#b7b7c6; --accent:#bb66ff; --ok:#4caf50;
    --card:#14141c; --ring:rgba(187,102,255,.35);
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f6fb; --ink:#1b1b25; --muted:#5a5a6a; --card:#ffffff; --ring:rgba(98,0,238,.18); }
  }
  *{box-sizing:border-box}
  body{margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink);}
  .wrap{max-width:1000px; margin:0 auto; padding:24px;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;}
  h1{font-size:22px; margin:0}
  .muted{color:var(--muted); font-size:14px}
  .grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px;}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:14px; overflow:hidden; box-shadow:0 6px 24px rgba(0,0,0,.16);}
  .card img{display:block; width:100%; height:280px; object-fit:cover; background:#000;}
  .card .body{padding:12px 12px 14px}
  .title{font-weight:700; margin:2px 0 8px}
  .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
  button{appearance:none; border:1px solid var(--ring); background:transparent; color:var(--ink); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600}
  button:hover{box-shadow:0 0 0 4px var(--ring)}
  button[disabled]{opacity:.55; cursor:not-allowed}
  .bar{height:10px; background:linear-gradient(90deg, var(--accent), var(--ok)); border-radius:999px; width:0%}
  .bar-wrap{background:rgba(255,255,255,.12); border-radius:999px; overflow:hidden; height:10px; flex:1}
  .stats{display:flex; gap:10px; align-items:center; margin-top:8px; font-variant-numeric:tabular-nums}
  .totals{margin-top:6px; font-size:13px; color:var(--muted)}
  .top-actions{display:flex; gap:10px; align-items:center}
  .pill{font-size:13px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1)}
  footer{margin-top:20px; color:var(--muted); font-size:13px; text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Image Voting Preview — Osa Otura</h1>
        <div class="muted">Choose your favorite. <strong>Two votes per device.</strong> Results update live.</div>
      </div>
      <div class="top-actions">
        <span id="votedState" class="pill">Status: can vote (2 left)</span>
        <button id="toggleResults">Show Results</button>
        <button id="resetLocal" title="Clear this device's vote only">Clear This Device</button>
      </div>
    </header>

    <section id="gallery" class="grid" aria-live="polite"></section>
    <div class="totals" id="totals">Total votes: 0</div>

    <footer>© <span id="yr"></span> SwamiG Institute • Simple client-side poll</footer>
  </div>

<script>
/* ---------------------- CONFIGURE HERE ---------------------- */
const IMAGES = [
  { id:"osa1", title:"Osa Otura — Layout A", src:"Osa Otura Logo 1.png", alt:"Osa Otura layout A" },
  { id:"osa2", title:"Osa Otura — Layout B", src:"temple logo 2.jpg",   alt:"Osa Otura layout B" },
  { id:"1", title:"Candidate 3", src:"1.jpg", alt:"Third candidate" },
  { id:"2", title:"Candidate 4", src:"2.jpg", alt:"Fourth candidate" },
];
/* ------------------------------------------------------------ */

const STORAGE_KEY   = "imageVote_results_v1";
const VOTES_USED_K  = "imageVote_votesUsed_v1";   // how many votes this device already cast
const MAX_VOTES     = 2;

const gallery = document.getElementById("gallery");
const totalsEl = document.getElementById("totals");
const votedState = document.getElementById("votedState");
const toggleResultsBtn = document.getElementById("toggleResults");
const resetLocalBtn = document.getElementById("resetLocal");
document.getElementById("yr").textContent = new Date().getFullYear();

/* ----- Results store ----- */
function getResults(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){
      const init = Object.fromEntries(IMAGES.map(i=>[i.id,0]));
      localStorage.setItem(STORAGE_KEY, JSON.stringify(init));
      return init;
    }
    const parsed = JSON.parse(raw);
    for(const img of IMAGES){ if(!(img.id in parsed)) parsed[img.id]=0; }
    return parsed;
  }catch(e){
    return Object.fromEntries(IMAGES.map(i=>[i.id,0]));
  }
}
function setResults(obj){ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

/* ----- Vote counter (per device) ----- */
function getVotesUsed(){
  const n = parseInt(localStorage.getItem(VOTES_USED_K) || "0", 10);
  return isNaN(n) ? 0 : n;
}
function setVotesUsed(n){
  localStorage.setItem(VOTES_USED_K, String(n));
}
function canVote(){ return getVotesUsed() < MAX_VOTES; }
function votesLeft(){ return Math.max(0, MAX_VOTES - getVotesUsed()); }

/* ----- Render ----- */
function render(showResults=false){
  const res = getResults();
  const total = Object.values(res).reduce((a,b)=>a+b,0);
  gallery.innerHTML = "";
  IMAGES.forEach(img=>{
    const count = res[img.id]||0;
    const pct = total>0 ? Math.round((count/total)*100) : 0;
    const card = document.createElement("article");
    card.className = "card";
    card.innerHTML = `
      <img src="${img.src}" alt="${img.alt||img.title}"
           onerror="this.style.opacity=.25; this.alt='(missing image)';" />
      <div class="body">
        <div class="title">${img.title}</div>
        <div class="row">
          <button data-id="${img.id}" ${canVote() ? "" : "disabled"} aria-label="Vote for ${img.title}">Vote</button>
          <div class="stats" style="${showResults?'':'display:none'}">
            <strong class="pct">${pct}%</strong>
            <div class="bar-wrap"><div class="bar" style="width:${pct}%"></div></div>
            <span class="count" title="votes">${count}</span>
          </div>
        </div>
      </div>
    `;
    gallery.appendChild(card);
  });

  totalsEl.textContent = `Total votes: ${total}`;
  votedState.textContent = canVote()
    ? `Status: can vote (${votesLeft()} left)`
    : `Status: done (0 left)`;
  document.querySelectorAll(".stats").forEach(s=>{ s.style.display = showResults ? "flex" : "none"; });
}

/* ----- Voting ----- */
function voteFor(id){
  if(!canVote()) return;
  const res = getResults();
  if(!(id in res)) res[id]=0;
  res[id]+=1;
  setResults(res);
  setVotesUsed(getVotesUsed()+1);
  render(currentlyShowingResults);
}

/* ----- UI Events ----- */
let currentlyShowingResults = false;

gallery.addEventListener("click", (e)=>{
  const btn = e.target.closest("button[data-id]");
  if(!btn) return;
  voteFor(btn.getAttribute("data-id"));
});

toggleResultsBtn.addEventListener("click", ()=>{
  currentlyShowingResults = !currentlyShowingResults;
  toggleResultsBtn.textContent = currentlyShowingResults ? "Hide Results" : "Show Results";
  render(currentlyShowingResults);
});

resetLocalBtn.addEventListener("click", ()=>{
  localStorage.removeItem(VOTES_USED_K);
  localStorage.removeItem("imageVote_hasVoted_v1");
  render(currentlyShowingResults);
});

/* ----- Init ----- */
render(false);
</script>
</body>
</html>
